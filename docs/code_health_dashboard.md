# Code Health & Architecture Dashboard

- Last updated: `2026-02-24T20:28:45Z`
- Generated by: `Codex`
- Scope: `frontend/src`, `backend/src`, `backend/test`

## How To Interpret This Dashboard
- Scores are `0-100` where higher is healthier.
- Metrics are a mixed baseline of static counts and conservative estimates.
- Regression policy for Codex changes:
  - `overall_score` drop > 3 => revert.
  - `solid_compliance` drop > 2 => revert.
  - `smells` or `complexity` growth > 10% => revert.
  - coverage decrease with new non-trivial logic and no tests => revert.

## How Codex Uses This Before Each Change
1. Read `docs/code_health_dashboard.md` and `docs/code_health_metrics.json`.
2. Check weak/risky modules and plan changes to avoid new coupling.
3. Implement minimal isolated changes.
4. Re-run tests/build and update metrics.
5. Compare against thresholds; keep or revert accordingly.

## Architecture Overview

### Frontend
- `app/` routing/bootstrap
- `pages/` view-level orchestration
- `components/` reusable UI blocks (`lila/`, `journey/`, `dice3d/`)
- `features/` feature modules (`deep-mode/`, `telegram/`)
- `context/` session state orchestration (`GameContext`)
- `domain/` game rules (`gameEngine`)
- `repositories/` persistence abstractions + Dexie adapters
- `lib/` utilities (animations, board profiles, move visualization, formatting)
- `content/` static board/card data

### Backend
- `routes/` API endpoints
- `lib/` auth token + Telegram verification
- `store/` in-memory/domain stores
- `types/` transport/domain typing

### Boundary Assessment
- Positive:
  - Domain move logic isolated in `domain/gameEngine.ts`.
  - Repository abstraction exists (`repositories/contracts` + adapters).
  - Telegram feature mostly encapsulated under `features/telegram`.
- Risks:
  - `pages` contain orchestration + persistence coupling (UI + data updates).
  - `GameContext` mixes state transitions and side-effect coordination in one unit.

## Patterns & SOLID Snapshot

| Area | Evidence | Assessment |
|---|---|---|
| Repository pattern | `frontend/src/repositories/contracts`, Dexie impl | Strong |
| Feature modularization | `features/deep-mode`, `features/telegram` | Strong |
| Single Responsibility | Large page components / context reducers | Mixed |
| Open/Closed | New board profiles/theme toggles added by extension | Good |
| Dependency inversion | UI mostly depends on context/repository interfaces | Good |
| Interface segregation | Separate repo contracts for sessions/moves/insights | Good |

## Strengths
- Clear frontend/backend split with typed API boundaries.
- Domain rules (`computeNextPosition`) are separated from rendering.
- Good test footprint for critical UI components and engine behavior.
- Reusable board profile/path infrastructure supports extension.

## Weaknesses / Risk Zones
- High orchestration density in `frontend/src/pages/GamePage.tsx`.
- Multiple responsibilities inside `GameContext` and `HistoryPage`.
- Some duplicated UI flow logic (modal/backdrop and animation controls).
- Coverage is broad but still moderate for stateful orchestration paths.

## Latest Change Impact
- Text persistence bugfix: note saves now use per-cell upsert semantics in repositories, preventing stale/corrupted older entries from shadowing newer edits.
- UI readability bugfix: modal textarea now has larger readable typography and explicit vertical scrolling for long multilingual notes.
- Test hardening: added multilingual (UA/RU/EN + emoji + multiline) round-trip assertions for modal input and repository storage.
- Documentation refresh: modernized `README.md` as a complete project landing page with architecture, setup, deployment, and contribution guidance.

## Metrics Table

| Metric | Value |
|---|---:|
| Total files (scanned) | 130 |
| Source files | 119 |
| Source LOC | 7802 |
| Frontend files / LOC | 107 / 7341 |
| Backend files / LOC | 12 / 461 |
| Test files / LOC | 26 / 1265 |
| Test file ratio vs source | 21.8% |
| Source files with direct test match | 24.2% |
| Coverage estimate | 65% (medium) |
| Long files > 500 LOC | 1 |
| Long files > 300 LOC | 3 |
| Long functions > 50 LOC | 18 |
| Duplicate blocks (estimate) | 6 |
| SOLID violations (estimate) | 10 |
| Smells per 1k LOC | 4.49 |

## Scorecard

| Score | Value |
|---|---:|
| Overall health | 79 |
| Architecture clarity | 81 |
| SOLID compliance | 77 |
| Test coverage | 65 |
| Complexity | 72 |
| Consistency | 84 |

## Top Risk Modules
- `frontend/src/pages/GamePage.tsx` (high): very large orchestration surface.
- `frontend/src/context/GameContext.tsx` (high): concentrated session lifecycle responsibilities.
- `frontend/src/pages/HistoryPage.tsx` (medium): UI concerns mixed with repository reads/writes.
- `frontend/src/features/telegram/ui/TelegramAppShell.tsx` (medium): runtime mode + auth orchestration complexity.

## Baseline Notes
- This is the initial persisted baseline for regression checks.
- Future Codex changes must update both dashboard files in the same commit.
